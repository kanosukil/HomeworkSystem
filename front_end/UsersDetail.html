<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>用户信息</title>
</head>

<body onload="initAJAX();checkToken()" style="background-color: gray;">
    <script src="js/commons.js"></script>
    <script>
        var token = getCookie('token');
        var uid = decodeURI(document.URL);
        uid = uid.substring(uid.indexOf('=') + 1);
    </script>
    <div id="head">
        <h1 style="text-align: center;font-size: 20px;">用户信息</h1>
    </div>
    <div id="body">
        <table id="body-table" align="center" border="1">
            <th id="userid" style="text-align: center;font-size: 12px;" colspan="3">
                <script>
                    var idth = document.getElementById('userid');
                    idth.innerHTML = 'UID:' + uid + '用户信息';
                </script>
            </th>
            <tr>
                <th>用户名:</th>
                <td>
                    <p id="username" style="text-align: center;font-size: 12px;width: 300px;"></p>
                </td>
                <td rowspan="2">
                    <img id="head_image"
                        style="margin: 5px;border: 3px;border-radius: 20px;padding: 10px;width: 90px;height: 90px;">
                </td>
            </tr>
            <tr>
                <th>电子邮件:</th>
                <td>
                    <p id="email" style="text-align: center;font-size: 12px;width: 300px;"></p>
                </td>
            </tr>
            <tr>
                <th>自我介绍:</th>
                <td colspan="2">
                    <p id="introduction" style="text-align: center;font-size: 12px;width: 300px;height: 200px;"></p>
                </td>
            </tr>
            <tr>
                <th>用户角色:</th>
                <td colspan="2">
                    学生:<input type="checkbox" name="multiple" id="student" value="学生" onclick="return false" />
                    老师:<input type="checkbox" name="multiple" id="teacher" value="老师" onclick="return false" />
                    管理员:<input type="checkbox" name="multiple" id="admin" value="管理员" onclick="return false" />
                </td>
            </tr>
        </table>
        <script>
            var username = '';
            var userpassword = '';
            var userhead_image = '';
            var userintrodction = '';
            var useremail = '';
            var usercreate_time = '';
            var userroles = '';
            var namep = document.getElementById('username');
            var head_image = document.getElementById('head_image');
            var emailp = document.getElementById('email');
            var introdctionp = document.getElementById('introduction');
            var student = document.getElementById('student');
            var teacher = document.getElementById('teacher');
            var admin = document.getElementById('admin');
            var request = {
                'method': 'get',
                'headers': {
                    'Content-type': 'application/json',
                    'token': token
                },
                'url': '/entry/search/user/get',
                'params': {
                    'uid': uid
                }
            };
            axios(request).then(res => {
                const data = res.data;
                console.log(data['message']);
                if (data['code'] == 200) {
                    const userinfo = data['objects'][0]['user'];
                    userroles = data['objects'][0]['roles'];
                    Array.from(userroles).forEach(i => {
                        switch (i) {
                            case 'Student': student.checked = true; break;
                            case 'Teacher': teacher.checked = true; break;
                            case 'Admin': admin.checked = true; break;
                        }
                    })
                    username = userinfo['name'];
                    userpassword = userinfo['password_hash'];
                    userhead_image = userinfo['head_image'];
                    userintrodction = userinfo['introduction'];
                    useremail = userinfo['email'];
                    usercreate_time = userinfo['create_time'];
                    namep.innerHTML = username;
                    head_image.src = 'http://localhost:10001/store/download/show?image-name=' + getHeadImage(userhead_image);
                    emailp.innerHTML = useremail;
                    introdctionp.innerHTML = userintrodction;
                } else {
                    console.log('异常:' + data);
                    username = 'exception!';
                    introdction = data;
                    email = 'exception!';
                }
            }).catch(err => {
                console.log('错误:' + err);
                username = 'error!';
                introdction = err;
                email = 'error!';
            })
        </script>
    </div>
    <div id="tail" style="text-align: center;">
        <p id='time-p' style="display: inline-block; margin:3px;border:3px;padding:10px;overflow:hidden;">
            <script>
                getTime('time-p');
            </script>
        </p>
        <a href="main.html" style="display: inline-block;margin:3px;border:3px;padding:10px;overflow:hidden;">返回主页</a>
    </div>
</body>

</html>